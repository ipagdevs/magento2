<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <type name="Ipag\Payment\Logger\Handler">
        <arguments>
            <argument name="filesystem" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
        </arguments>
    </type>

    <!-- Payment Method Facade configuration -->
    <virtualType name="IpagPaymentGenericFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Ipag\Payment\Model\Ui\IpagGenericConfigProvider::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Ipag\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">Ipag\Payment\Block\Info\Cc</argument>
            <argument name="valueHandlerPool" xsi:type="object">IpagPaymentGenericValueHandlerPool</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentCcFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Ipag\Payment\Model\Ui\IpagCcConfigProvider::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Ipag\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">Ipag\Payment\Block\Info\Cc</argument>
            <argument name="valueHandlerPool" xsi:type="object">IpagPaymentCcValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">IpagPaymentCcValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">IpagPaymentCcCommandPool</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentBoletoFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Ipag\Payment\Model\Ui\IpagBoletoConfigProvider::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Ipag\Payment\Block\Form\Boleto</argument>
            <argument name="infoBlockType" xsi:type="string">Ipag\Payment\Block\Info\Boleto</argument>
            <argument name="valueHandlerPool" xsi:type="object">IpagPaymentBoletoValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">IpagPaymentBoletoValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">IpagPaymentBoletoCommandPool</argument>
        </arguments>
    </virtualType>


    <virtualType name="IpagPaymentGenericValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">IpagPaymentGenericConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentGenericConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">IpagPaymentGenericConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="IpagPaymentCcValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">IpagPaymentCcConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentCcConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">IpagPaymentCcConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="IpagPaymentBoletoValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">IpagPaymentBoletoConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentBoletoConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">IpagPaymentBoletoConfig</argument>
        </arguments>
    </virtualType>

    <!-- Commands infrastructure -->
    <virtualType name="IpagPaymentCcCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">IpagPaymentCcAuthorizeCommand</item>
                <item name="capture" xsi:type="string">IpagPaymentCaptureCommand</item>
                <item name="void" xsi:type="string">IpagPaymentCancelCommand</item>
                <item name="refund" xsi:type="string">IpagPaymentRefundCommand</item>
                <item name="cancel" xsi:type="string">IpagPaymentCancelCommand</item>
                <!--<item name="vault_authorize" xsi:type="string">IpagPaymentCcVaultAuthorizeCommand</item>-->
            </argument>
        </arguments>
    </virtualType>

    <!-- Command managers section for Vault -->
    <virtualType name="IpagPaymentCcCommandManager" type="Magento\Payment\Gateway\Command\CommandManager">
        <arguments>
            <argument name="commandPool" xsi:type="object">IpagPaymentCcCommandPool</argument>
        </arguments>
    </virtualType>
    <type name="Magento\Payment\Gateway\Command\CommandManagerPool">
        <arguments>
            <argument name="executors" xsi:type="array">
                <item name="ipagcc" xsi:type="string">IpagPaymentCcCommandManager</item>
            </argument>
        </arguments>
    </type>

    <virtualType name="IpagPaymentBoletoCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">IpagPaymentBoletoAuthorizeCommand</item>
                <item name="capture" xsi:type="string">IpagPaymentCaptureCommand</item>
                <item name="void" xsi:type="string">IpagPaymentCancelCommand</item>
                <item name="refund" xsi:type="string">IpagPaymentRefundCommand</item>
                <item name="cancel" xsi:type="string">IpagPaymentCancelCommand</item>
            </argument>
        </arguments>
    </virtualType>


    <!-- Authorization command  -->
    <virtualType name="IpagPaymentCcAuthorizeCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IpagPaymentCcAuthorizeRequest</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\TransactionPayment</argument>
            <argument name="validator" xsi:type="object">CheckoutResponseValidator</argument>
            <argument name="handler" xsi:type="object">IpagPaymentCcResponseHandlerComposite</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentBoletoAuthorizeCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IpagPaymentBoletoAuthorizeRequest</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\TransactionPayment</argument>
            <argument name="validator" xsi:type="object">CheckoutResponseValidator</argument>
            <argument name="handler" xsi:type="object">IpagPaymentBoletoResponseHandlerComposite</argument>
        </arguments>
    </virtualType>

    <!-- Capture command  -->
    <virtualType name="IpagPaymentCaptureCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IpagPaymentCaptureRequest</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\TransactionCapture</argument>
            <argument name="validator" xsi:type="object">Ipag\Payment\Gateway\Validator\CaptureResponseValidator</argument>
            <argument name="handler" xsi:type="object">IpagPaymentCaptureResponseHandlerComposite</argument>
        </arguments>
    </virtualType>
    <!--Refund command-->
    <virtualType name="IpagPaymentRefundCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IpagPaymentRefundRequest</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\TransactionRefund</argument>
            <argument name="validator" xsi:type="object">Ipag\Payment\Gateway\Validator\RefundResponseValidator</argument>
            <argument name="handler" xsi:type="object">IpagPaymentRefundResponseHandlerComposite</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentCancelCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IpagPaymentCancelRequest</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\TransactionCancel</argument>
            <argument name="validator" xsi:type="object">Ipag\Payment\Gateway\Validator\CancelResponseValidator</argument>
            <argument name="handler" xsi:type="object">IpagPaymentCancelResponseHandlerComposite</argument>
        </arguments>
    </virtualType>

    <!-- Value validators infrastructure -->
    <virtualType name="IpagPaymentCcValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">IpagCcCountryValidator</item>
                <item name="global" xsi:type="string">Ipag\Payment\Gateway\Validator\InstallmentValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagCcCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">IpagPaymentCcConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="IpagPaymentBoletoValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">IpagBoletoCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagBoletoCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">IpagPaymentBoletoConfig</argument>
        </arguments>
    </virtualType>

    <!-- Configuration reader -->
    <virtualType name="IpagPaymentGenericConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Ipag\Payment\Model\Ui\IpagGenericConfigProvider::CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentCcConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Ipag\Payment\Model\Ui\IpagCcConfigProvider::CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagPaymentBoletoConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Ipag\Payment\Model\Ui\IpagBoletoConfigProvider::CODE</argument>
        </arguments>
    </virtualType>

    <type name="Ipag\Payment\Logger\Logger">
        <arguments>
            <argument name="name" xsi:type="string">ipagLogger</argument>
            <argument name="handlers"  xsi:type="array">
                <item name="system" xsi:type="object">Ipag\Payment\Logger\Handler</item>
            </argument>
        </arguments>
    </type>

    <!-- Commands infrastructure -->
    <virtualType name="IpagCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">IpagAuthorizeCommand</item>
                <item name="capture" xsi:type="string">IpagCaptureCommand</item>
                <item name="void" xsi:type="string">IpagVoidCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!--<virtualType name="IpagConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">\Ipag\Payment\Model\Ui\ConfigProvider::CODE</argument>
        </arguments>
    </virtualType>
    <type name="Ipag\Payment\Model\Ui\ConfigProvider">
        <arguments>
            <argument name="config" xsi:type="object">IpagConfig</argument>
        </arguments>
    </type>
    <type name="\Ipag\Payment\Model\ModuleHelper">
        <arguments>
            <argument name="config" xsi:type="object">IpagConfig</argument>
        </arguments>
    </type>-->

    <!-- Validator Pool -->
    <virtualType name="IpagCcCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">IpagConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagGlobalValidator" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">IpagCountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="global" xsi:type="string">IpagGlobalValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Ipag\Payment\Gateway\Validator\InstallmentValidator">
        <arguments>
            <argument name="serializer" xsi:type="object">Magento\Framework\Serialize\Serializer\Serialize</argument>
        </arguments>
    </type>
    <type name="Ipag\Payment\Model\Ui\IpagCcConfigProvider">
        <arguments>
            <argument name="serializer" xsi:type="object">Magento\Framework\Serialize\Serializer\Serialize</argument>
        </arguments>
    </type>

    <!--<virtualType name="IpagPaymentConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">IpagPaymentConfig</argument>
        </arguments>
    </virtualType>
    <type name="\Ipag\Payment\Gateway\Config\DefaultValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">IpagPaymentConfigValueHandler</item>
            </argument>
        </arguments>
    </type>
    <virtualType name="IpagPaymentDefaultValueHandlerPool" type="\Ipag\Payment\Gateway\Config\DefaultValueHandlerPool"/>-->

    <!-- Client -->
    <!--<type name="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="logger" xsi:type="object">IpagLogger</argument>
            <argument name="config" xsi:type="object">IpagConfig</argument>
        </arguments>
    </type>
    <virtualType name="IpagClientCreateTransaction" type="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="operation" xsi:type="const">\Ipag\Payment\Gateway\Client\Sdk::CREATE_TRANSACTION</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagClientQueryTransaction" type="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="operation" xsi:type="const">\Ipag\Payment\Gateway\Client\Sdk::QUERY_TRANSACTION</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagClientCreateCustomer" type="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="operation" xsi:type="const">\Ipag\Payment\Gateway\Client\Sdk::CREATE_CUSTOMER</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagClientUpdateCustomer" type="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="operation" xsi:type="const">\Ipag\Payment\Gateway\Client\Sdk::UPDATE_CUSTOMER</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagClientQueryToken" type="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="operation" xsi:type="const">\Ipag\Payment\Gateway\Client\Sdk::QUERY_CUSTOMER_TOKEN</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagClientCancelTransaction" type="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="operation" xsi:type="const">\Ipag\Payment\Gateway\Client\Sdk::CANCEL_TRANSACTION</argument>
        </arguments>
    </virtualType>
    <virtualType name="IpagClientRefundTransaction" type="\Ipag\Payment\Gateway\Client\Sdk">
        <arguments>
            <argument name="operation" xsi:type="const">\Ipag\Payment\Gateway\Client\Sdk::REFUND_TRANSACTION</argument>
        </arguments>
    </virtualType>-->

    <!-- Add Ipag methods to the Adapter -->
    <!--<virtualType name="IpagMethodAdapter" type="\Ipag\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="methodInstances" xsi:type="array">
                <item name="direct" xsi:type="string">IpagFacade</item>
            </argument>
        </arguments>
    </virtualType>-->

    <!--<virtualType name="IpagMethodAdapter" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code"               xsi:type="const">\Ipag\Payment\Model\Ui\IpagGenericConfigProvider::CODE</argument>
            <argument name="formBlockType"      xsi:type="string">IpagFormBlock</argument>
            <argument name="infoBlockType"      xsi:type="string">\Ipag\Payment\Block\Info\Cc</argument>
            <<argument name="valueHandlerPool"   xsi:type="object">IpagValueHandlerPool</argument>
            <argument name="validatorPool"      xsi:type="object">IpagValidatorPool</argument>
            <<argument name="commandPool"        xsi:type="object">IpagConnectionCommandPool</argument>
            <argument name="config"             xsi:type="object">IpagConfig</argument>
        </arguments>
    </virtualType>-->

    <!-- Authorize command -->
    <virtualType name="IpagAuthorizeCommand" type="\Ipag\Payment\Gateway\Command\AuthorizeStrategyCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">IpagAuthorizationRequest</argument>
            <argument name="handler" xsi:type="object">IpagResponseHandlerComposite</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\ClientMock</argument>
        </arguments>
    </virtualType>

    <!-- Authorization Request -->
    <virtualType name="IpagAuthorizationRequest" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="transaction" xsi:type="string">Ipag\Payment\Gateway\Request\AuthorizationRequest</item>
                <item name="customer" xsi:type="string">Magento\Braintree\Gateway\Request\CustomerDataBuilder</item>
                <item name="payment" xsi:type="string">Magento\Braintree\Gateway\Request\PaymentDataBuilder</item>
                <item name="channel" xsi:type="string">Magento\Braintree\Gateway\Request\ChannelDataBuilder</item>
                <item name="address" xsi:type="string">Magento\Braintree\Gateway\Request\AddressDataBuilder</item>
                <item name="vault" xsi:type="string">Magento\Braintree\Gateway\Request\VaultDataBuilder</item>
                <item name="device_data" xsi:type="string">Magento\Braintree\Gateway\Request\KountPaymentDataBuilder</item>
                <item name="dynamic_descriptor" xsi:type="string">Magento\Braintree\Gateway\Request\DescriptorDataBuilder</item>
                <item name="store" xsi:type="string">Magento\Braintree\Gateway\Request\StoreConfigBuilder</item>
                <item name="merchant_account" xsi:type="string">Magento\Braintree\Gateway\Request\MerchantAccountDataBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <type name="Ipag\Payment\Gateway\Request\AuthorizationRequest">
        <arguments>
            <argument name="config" xsi:type="object">IpagConfig</argument>
        </arguments>
    </type>

    <!-- Capture command -->
    <virtualType name="IpagCaptureCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Ipag\Payment\Gateway\Request\CaptureRequest</argument>
            <argument name="handler" xsi:type="object">Ipag\Payment\Gateway\Response\TxnIdHandler</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="validator" xsi:type="object">Ipag\Payment\Gateway\Validator\ResponseCodeValidator</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\ClientMock</argument>
        </arguments>
    </virtualType>

    <!-- Capture Request -->
    <type name="Ipag\Payment\Gateway\Request\CaptureRequest">
        <arguments>
            <argument name="config" xsi:type="object">IpagConfig</argument>
        </arguments>
    </type>

    <!-- Void command -->
    <virtualType name="IpagVoidCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Ipag\Payment\Gateway\Request\VoidRequest</argument>
            <argument name="handler" xsi:type="object">Ipag\Payment\Gateway\Response\TxnIdHandler</argument>
            <argument name="transferFactory" xsi:type="object">Ipag\Payment\Gateway\Http\TransferFactory</argument>
            <argument name="validator" xsi:type="object">Ipag\Payment\Gateway\Validator\ResponseCodeValidator</argument>
            <argument name="client" xsi:type="object">Ipag\Payment\Gateway\Http\Client\ClientMock</argument>
        </arguments>
    </virtualType>

    <!-- Void Request -->
    <type name="Ipag\Payment\Gateway\Request\VoidRequest">
        <arguments>
            <argument name="config" xsi:type="object">IpagConfig</argument>
        </arguments>
    </type>

    <!-- Response handlers -->
    <virtualType name="IpagResponseHandlerComposite" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="txnid" xsi:type="string">Ipag\Payment\Gateway\Response\TxnIdHandler</item>
                <item name="fraud" xsi:type="string">Ipag\Payment\Gateway\Response\FraudHandler</item>
            </argument>
        </arguments>
    </virtualType>

</config>